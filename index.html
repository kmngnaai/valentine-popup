<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Valentine's For Keiii</title>

<style>
body{
    margin:0;
    min-height:100vh;
    background:url("valentines-mobile.png") center/cover no-repeat #f6d6df;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:"Segoe UI","Helvetica Neue",Arial,sans-serif;
    overflow:hidden;
    transition:.6s;
}

/* Overlay */
body::before{
    content:"";
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.22);
    z-index:0;
    transition:.6s;
    pointer-events:none; /* TH√äM D√íNG N√ÄY */
}


.dark::before{
    background:rgba(0,0,0,.55);
}

/* ================= STICKER ================= */
.sticker{
    position:fixed;
    pointer-events:auto;
    z-index:1;
    opacity:0;
    animation:life 4.6s ease-in-out forwards;
    transition:opacity .6s;
}

.letter-open .sticker{
    opacity:.15 !important;
}

@keyframes life{
    0%   {opacity:0; transform:scale(.85);}
    26%  {opacity:.95; transform:scale(1);}
    74%  {opacity:.95;}
    100% {opacity:0; transform:scale(.9);}
}


/* Panda */
.panda{
    animation:
        life 4.6s ease-in-out forwards,
        pandaGlow 2.2s ease-in-out infinite alternate;
}


@keyframes pandaGlow{
    from{filter:drop-shadow(0 0 8px rgba(255,255,255,0.8));}
    to{filter:drop-shadow(0 0 20px rgba(255,192,203,1));}
}

.panda:active{
    transform:scale(0.7);
    transition:transform .15s ease;
}

/* ================= POPUP ================= */
.pink-box{
    position:relative;
    z-index:2;
    width:min(92vw,460px);
    padding:30px 26px 34px;
    background:linear-gradient(180deg,#fff9fc,#fff2f7);
    border-radius:26px;
    border:2px solid #f0b7d3;
    box-shadow:0 14px 36px rgba(0,0,0,.28);
    text-align:center;
}

.heart{
    font-size:46px;
    margin-bottom:10px;
    animation:beat 2.2s infinite;
}

.text{
    font-size:22px;
    font-weight:600;
    color:#7a1f47;
}

.btn{
    margin-top:22px;
    padding:10px 48px;
    font-size:17px;
    background:linear-gradient(180deg,#f7c4de,#f2aecd);
    border:none;
    border-radius:999px;
    cursor:pointer;
    color:#4d0f2d;
}

.hidden{display:none}
@keyframes beat{30%{transform:scale(1.1)}}

/* ================= LOVE TEXT ================= */
.love-text{
    position:fixed;
    font-size:26px;
    font-weight:900;
    pointer-events:none;
    z-index:4;
    animation:loveFloat 1.4s ease-out forwards;
}

@keyframes loveFloat{
    0%{opacity:0; transform:translateY(0) scale(.8);}
    25%{opacity:1;}
    100%{opacity:0; transform:translateY(-100px) scale(1.2);}
}

.flying-heart{
    position:fixed;
    pointer-events:none;
    z-index:3;
    animation:heartFly 1.6s ease-out forwards;
}

@keyframes heartFly{
    0%{opacity:1; transform:translate(0,0) scale(.8);}
    100%{opacity:0; transform:translate(var(--x),var(--y)) scale(1.8);}
}

/* ================= PHONG TH∆Ø ================= */
.envelope{
    position:fixed;
    font-size:70px;
    z-index:10;
    top:45%;
    left:50%;
    transform:translate(-50%,-50%);
    cursor:pointer;
    transition:transform 0.3s ease;
}

/* khi xu·∫•t hi·ªán m·ªõi r∆°i */
.envelope.drop{
    animation:drop 1.2s ease forwards;
}

.envelope:active{
    transform:translate(-50%,-50%) scale(0.95);
}


@keyframes shake{
    0%{transform:translateX(-50%) rotate(0deg);}
    25%{transform:translateX(-50%) rotate(3deg);}
    50%{transform:translateX(-50%) rotate(-3deg);}
    75%{transform:translateX(-50%) rotate(2deg);}
    100%{transform:translateX(-50%) rotate(0deg);}
}

@keyframes drop{
    to{ top:45%; }
}

/* ================= L√Å TH∆Ø ================= */
/* ================= L√Å TH∆Ø OVERLAY ================= */
.letter{
    position:fixed;
    inset:0;
    z-index:5000;

    display:flex;
    justify-content:center;
    align-items:center;

    background:rgba(0,0,0,0.35);

    pointer-events:none;
    opacity:0;
    transition:.4s ease;
}

.letter.show{
    pointer-events:auto;
    opacity:1;
}

/* Card n·ªïi */
.letter-card{
    width:min(96vw,720px);   /* r·ªông h∆°n n·ªØa */
    max-height:90vh;
    overflow-y:auto;

    background:white;
    border-radius:18px;
    padding:80px 22px 36px;  /* gi·∫£m padding ngang cho r·ªông h∆°n */

    box-shadow:0 25px 60px rgba(0,0,0,.35);
    position:relative;

    transform:scale(.9);
    transition:.3s ease;
}

.letter-card h2{
    text-align:center;
    margin-bottom:18px;
    font-size:28px;
    font-weight:600;   /* gi·∫£m ƒë·∫≠m */
    color:#c2185b;
}

.letter-card div{
    font-size:25px;
    line-height:1.3;
    margin-bottom:3px;
    font-weight:400;
}






.letter.show .letter-card{
    transform:scale(1);
}

/* N√∫t ƒë√≥ng c·ªë ƒë·ªãnh */
.close-btn{
    position:absolute;   /* ƒë·ªïi t·ª´ sticky -> absolute */
    top:20px;
    right:20px;

    background:#ffe6f1;
    border:none;
    border-radius:30px;
    padding:8px 18px;

    font-weight:600;
    cursor:pointer;
    color:#c2185b;

    box-shadow:0 5px 15px rgba(0,0,0,.15);
}




/* ===== Con tr·ªè tim nh·∫•p nh√°y ===== */
.cursor-heart{
    display:inline-block;
    margin-left:4px;
    font-size:22px;
    animation:blinkCursor 1.2s infinite, heartBeatCursor 2.2s infinite;
}

@keyframes blinkCursor{
    0%,100%{opacity:1;}
    50%{opacity:0;}
}

@keyframes heartBeatCursor{
    30%{transform:scale(1.2);}
}
/* ================= BG HEART FLOAT ================= */
.bg-heart{
    position:fixed;
    font-size:22px;
    opacity:0.08;
    pointer-events:none;
    z-index:19;
    animation:bgFloat linear forwards;
}

@keyframes bgFloat{
    from{transform:translateY(100vh);}
    to{transform:translateY(-120vh);}
}

</style>
</head>

<body>

<div id="popup1" class="pink-box">
    <div class="heart">üíó</div>
    <div id="text1" class="text"></div>
    <button class="btn" onclick="nextPopup()">ok</button>
</div>

<div id="popup2" class="pink-box hidden">
    <div class="heart">üíì</div>
    <div id="text2" class="text"></div>
    <button class="btn" onclick="closePopup()">ok</button>
</div>

<div id="envelope" class="envelope hidden">üíå</div>

<div id="letter" class="letter">

    <div class="letter-card">

        <button id="closeLetterBtn" class="close-btn">
             üíó  ƒê√≥ng th∆∞
        </button>

        <h2>14.02.2026</h2>

        <div id="letterContent"></div>

    </div>

</div>



<script>

/* ================= RANDOM MESSAGE ================= */

const loveMessages = [
"Em y√™u Ki·ªÅu",
"Em y√™u ch·ªã qu√≥ √≤",
"Em nh·ªõ Ki·ªÅu",
"Em nh·ªõ ch·ªã qu√≥ √≤",
"em y√™u b√© Keii",
"b√© Keii c·ªßa R√πa",
"y√™u Keii",
"Ki·ªÅu ∆°i, moa moaaa",
"c·ª•c c∆∞ng ∆°i, mu·ªën √¥m √¥m",
"√¥m √¥m",
"y√™u Ki·ªÅu",
"y√™u ch·ªã",
"nh·ªõ Ki·ªÅu",
"nh·ªõ ch·ªã",
"Umoaa umoazz",
"ch·ª•t ch·ª•ttt",
"hun hun hun",
"hun ch·ª•c c√°ii",
"h√≠t h√≠tt",
"c·ª•c c∆∞ng ngoan ngoan",
"em th∆∞∆°nggg Ki·ªÅuu",
"em mu·ªën √¥m √¥m",
"c·ª•c c∆∞ng ∆°i, mu·ªën hun hunn",
"c·ª•c c∆∞ng ∆°i, mu·ªën ch·ªã",
"c·ª•c c∆∞ng c·ª•c c∆∞ng em y√™u ch·ªã",
"c·ª•c c∆∞ng ∆°i, mu·ªën ƒÉn g√¨ d·∫°",
"c·ª•c c∆∞ng c√≥ nh·ªõ em h√¥ng d·∫°",
"c·ª•c c∆∞ng c√≥ y√™u em h√¥ng d·∫°",
"em y√™u ch·ªã nhi·ªÅu l·∫Øm lu√¥n √°",
"d·ª£ ∆°ii, em y√™u ch·ªã"
];

let lastIndex=-1;
let stickerInterval = null;
let bgInterval = null;
let pandaPool = [];
let normalPool = [];
const envelope = document.getElementById("envelope");
const letter = document.getElementById("letter");
const letterContent = document.getElementById("letterContent");
const popup1 = document.getElementById("popup1");
const popup2 = document.getElementById("popup2");
const closeLetterBtn = document.getElementById("closeLetterBtn");

/* ================= TYPE WRITER ================= */

function typeWriter(element, text, speed = 45, showCursor = true){

    element.innerHTML = "";

    const chars = [...text]; // FIX emoji
    let i = 0;
    let cursor = null;

    if(showCursor){
        cursor = document.createElement("span");
        cursor.className = "cursor-heart";
        cursor.textContent = "üíó";
        element.appendChild(cursor);
    }

    function typing(){
        if(i < chars.length){

            if(cursor){
                element.insertBefore(
                    document.createTextNode(chars[i]),
                    cursor
                );
            } else {
                element.append(chars[i]);
            }

            i++;
            setTimeout(typing, speed);
        }
    }

    typing();
}



function getRandomMessage(){
    let index;
    do{
        index=Math.floor(Math.random()*loveMessages.length);
    }while(index===lastIndex);
    lastIndex=index;
    return loveMessages[index];
}

/* ================= AUTO PASTEL COLOR ================= */

function generateCuteColor(){
    const hue=Math.floor(Math.random()*360);
    const saturation=85;   // t∆∞∆°i
    const lightness=65;    // ƒë·ªß s√°ng ƒë·ªÉ r√µ
    return `hsl(${hue},${saturation}%,${lightness}%)`;
}

/* ================= STICKER ENGINE ================= */

function rand(min,max){return Math.random()*(max-min)+min;}
function randInt(min,max){return Math.floor(rand(min,max));}
function shuffleArray(array){
    for(let i = array.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
function initPools(){

    pandaPool = [];
    for(let i=1;i<=23;i++){
        pandaPool.push(i);
    }
    shuffleArray(pandaPool);

    normalPool = [];
    for(let i=1;i<=47;i++){
        normalPool.push(i);
    }
    shuffleArray(normalPool);
}

// üëá PH·∫¢I ƒê·∫∂T RA NGO√ÄI
function preloadSmart(){

    // clone pool
    const normalQueue = [...normalPool];
    const pandaQueue  = [...pandaPool];

    // wave ƒë·∫ßu
    const firstBatch = [
        ...normalQueue.slice(0,15).map(id => ({id, type:"normal"})),
        ...pandaQueue.slice(0,5).map(id => ({id, type:"panda"}))
    ];

    // ph·∫ßn c√≤n l·∫°i
    const remainingBatch = [
        ...normalQueue.slice(15).map(id => ({id, type:"normal"})),
        ...pandaQueue.slice(5).map(id => ({id, type:"panda"}))
    ];

    // ===== preload wave ƒë·∫ßu ngay =====
    firstBatch.forEach(item=>{
        const img = new Image();

        if(item.type === "normal"){
            img.src = `webp-stickers/${item.id}.webp`;
        }else{
            img.src = `webp-stickers-panda/${item.id}.webp`;
        }
    });

    // ===== preload ph·∫ßn c√≤n l·∫°i t·ª´ t·ª´ =====
    let index = 0;

    function loadNext(){
        if(index >= remainingBatch.length) return;

        const item = remainingBatch[index];
        const img = new Image();

        if(item.type === "normal"){
            img.src = `webp-stickers/${item.id}.webp`;
        }else{
            img.src = `webp-stickers-panda/${item.id}.webp`;
        }

        index++;
        setTimeout(loadNext, 80);
    }

    setTimeout(loadNext, 1000);
}




function getGridPositions(){

    const positions = [];
    const totalNeeded = 20; // 10 th∆∞·ªùng + 10 panda
    const minDistance = window.innerWidth < 768 ? 55 : 80; // kho·∫£ng c√°ch t·ªëi thi·ªÉu gi·ªØa sticker

    const centerYMin = innerHeight * 0.35;
    const centerYMax = innerHeight * 0.65;

    let attempts = 0;

    while(positions.length < totalNeeded && attempts < 1200){
        attempts++;

        let x = rand(40, innerWidth - 80);
        let y = rand(40, innerHeight - 80);

        // tr√°nh v√πng popup gi·ªØa mobile
        if(window.innerWidth < 768){
            if(y > centerYMin && y < centerYMax){
                continue;
            }
        }

        let tooClose = false;

        for(let p of positions){
            let dx = p.x - x;
            let dy = p.y - y;
            let distance = Math.sqrt(dx*dx + dy*dy);

            if(distance < minDistance){
                tooClose = true;
                break;
            }
        }

        if(!tooClose){
            positions.push({x,y});
        }
    }

    return shuffleArray(positions);
}
function spawnBgHeart(){
    const h = document.createElement("div");
    h.className="bg-heart";
    h.textContent="üíó";

    h.style.left = rand(0,innerWidth)+"px";
    h.style.fontSize = rand(16,28)+"px";
    h.style.animationDuration = rand(6,12)+"s";

    document.body.appendChild(h);

    setTimeout(()=>h.remove(),12000);
}



function showLove(x,y){
    const div=document.createElement("div");
    div.className="love-text";
    div.textContent=getRandomMessage()+" üíó";

    const color=generateCuteColor();
    div.style.color=color;

    // glow c√πng t√¥ng m√†u
    div.style.textShadow=`
        0 3px 8px rgba(0,0,0,0.5),
        0 0 18px ${color}
    `;

    div.style.left=x+"px";
    div.style.top=y+"px";

    document.body.appendChild(div);
    setTimeout(()=>div.remove(),1400);

    for(let i=0;i<4;i++){
        const h=document.createElement("div");
        h.className="flying-heart";
        h.textContent="üíó";
        h.style.fontSize=rand(24,44)+"px";
        h.style.left=x+"px";
        h.style.top=y+"px";
        h.style.setProperty("--x",rand(-140,140)+"px");
        h.style.setProperty("--y",rand(-180,-80)+"px");
        document.body.appendChild(h);
        setTimeout(()=>h.remove(),1600);
    }
}

function spawnSticker(src,isPanda,position){
    const img=new Image();
    img.src=src;
    img.className="sticker";
    if(isPanda) img.classList.add("panda");

    img.onload=()=>{
        img.style.width = isPanda
            ? rand(80,100) + "px"      // üêº Panda nh·ªè h∆°n
            : rand(95,115) + "px";     // üéÄ Th∆∞·ªùng l·ªõn h∆°n

        img.style.left = position.x + "px";
        img.style.top = position.y + "px";


        img.addEventListener("click",(e)=>{
            showLove(e.clientX,e.clientY);
        });

        document.body.appendChild(img);
        setTimeout(()=>img.remove(),4600);
    };
}

function spawnWave(){

    if(pandaPool.length < 5 || normalPool.length < 15){
        initPools();
    }

    const positions = getGridPositions();
    let posIndex = 0;

    // ===== 15 sticker th∆∞·ªùng =====
    for(let i=0;i<15;i++){
    const pos = positions[posIndex++];
    if(!pos) break;   // üëà TH√äM D√íNG N√ÄY

    const id = normalPool.pop();

    spawnSticker(
        `webp-stickers/${id}.webp`,
        false,
        pos
    );
}


    // ===== 5 panda =====
for(let i=0;i<5;i++){
    const pos = positions[posIndex++];
    if(!pos) break;   // üëà TH√äM D√íNG N√ÄY

    const id = pandaPool.pop();


        spawnSticker(
            `webp-stickers-panda/${id}.webp`,
            true,
            pos
        );
    }
}





function startSticker(){
    if(stickerInterval) return; // tr√°nh ch·∫°y nhi·ªÅu l·∫ßn

    spawnWave();
    stickerInterval = setInterval(spawnWave,4600);
}
window.onload = function(){

    initPools();
    preloadSmart();   // üëà thay d√≤ng n√†y

    typeWriter(
        document.getElementById("text1"),
        "B√© Keii ∆°ii, b√© Keii c√≥ bi·∫øt h√¥ngg??"
    );
};





/* ================= POPUP FLOW ================= */

function nextPopup(){
    popup1.classList.add("hidden");
    popup2.classList.remove("hidden");

    typeWriter(
        document.getElementById("text2"),
        "Em y√™u ch·ªã nhi·ªÅu l·∫Øm lu√¥n √°!"
    );

    startSticker();
}



function closePopup(){
    popup2.classList.add("hidden");
    document.body.classList.add("dark");
    envelope.classList.remove("hidden");
    envelope.classList.add("drop");

}

/* ================= LETTER ================= */

const letterParagraphs = [

"Hi t√¨nh y√™u c·ªßa em üíó",

"T√¨nh y√™u c·ªßa em x·ª©ng ƒë√°ng c√≥ ƒë∆∞·ª£c nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t tr√™n th·∫ø gian n√†y.",
"Ahiihi‚Ä¶ v√† ƒëi·ªÅu ƒë√≥ ch√≠nh l√† em ƒë√≥.",

"Hello c·ª•c c∆∞nggg, em ·ªü ƒë√¢y ƒë·ªÉ y√™u th∆∞∆°ng ch·ªã.",

"Ch·ª•t ch·ª•t ch·ª•t üíã",
"Th∆∞·ªüng cho c·ª•c c∆∞ng m·ªôt ngh√¨n n·ª• h√¥n b·ªüi v√¨ ng∆∞·ªùi y√™u c·ªßa em ƒë√£ ƒë·∫øn.",

"Ch·ªã l√†m em c·∫£m nh·∫≠n ƒë∆∞·ª£c t√¨nh y√™u.",
"C·∫£m nh·∫≠n ƒë∆∞·ª£c s·ª± y√™u th∆∞∆°ng v√† c∆∞ng chi·ªÅu.",
"C·∫£m nh·∫≠n ƒë∆∞·ª£c √°nh m·∫Øt ch·ªã n√≥i l√™n r·∫±ng ch·ªã y√™u em.",

"Ahihiii‚Ä¶ ra l√† √°nh m·∫Øt c≈©ng bi·∫øt n√≥i t√¨nh y√™u ƒë√≥ nha ‚ú®",

"Em c·∫£m nh·∫≠n ƒë∆∞·ª£c h·∫°nh ph√∫c m√† ng∆∞·ªùi y√™u mang ƒë·∫øn cho em m·ªói ng√†y.",

"B·ªüi v√¨ l·ªùi n√≥i c√≥ mang nhi·ªát ƒë·ªô, ƒë√¥i khi v√¥ t√¨nh l√†m m√¨nh ƒëau l√≤ng, t·ªßi th√¢n, u·ª∑ khu·∫•t üëâüëà",

"Nh∆∞ng m√† c·ª•c c∆∞ng ∆°i, con tim c≈©ng mang nhi·ªát ƒë·ªô ƒë√≥.",
"M√¨nh √¥m nhau ƒë·ªÉ c·∫£m nh·∫≠n r·ªìi c√πng nhau xoa d·ªãu nhau ha üíû",

"Em ch·ªâ mu·ªën n√≥i v·ªõi ng∆∞·ªùi y√™u r·∫±ng:",

"Em y√™u ch·ªã.",
"M√¨nh b√™n nhau th·∫≠t l√¢u nha c·ª•c c∆∞ng.",
"S·∫Ω c√≥ kh√≥ khƒÉn nh∆∞ng m√¨nh v·∫´n ki√™n ƒë·ªãnh n·∫Øm tay nhau ü§ç"

];



envelope.onclick=()=>{
   envelope.classList.remove("drop"); // tr√°nh reset animation
   envelope.style.display = "none";


    document.body.classList.add("letter-open");
    letter.classList.add("show");
   bgInterval = setInterval(spawnBgHeart,800);


    letterParagraphs.forEach((text,i)=>{
        setTimeout(()=>{
            const p=document.createElement("div");
            typeWriter(p, text, 30, false);
            letterContent.appendChild(p);
        },i*1200);
    });
};

closeLetterBtn.onclick = function(){

    clearInterval(bgInterval);

    // ·∫®n th∆∞
    letter.classList.remove("show");

    // Tr·∫£ n·ªÅn s√°ng
    document.body.classList.remove("letter-open");
    document.body.classList.remove("dark");

    // X√≥a n·ªôi dung th∆∞
    letterContent.innerHTML = "";

    // KH√îNG hi·ªán l·∫°i envelope
    envelope.style.display = "none";

    // KH√îNG hi·ªán popup n·ªØa
    popup1.classList.add("hidden");
    popup2.classList.add("hidden");

    // Sticker v·∫´n ch·∫°y v√¨ startSticker() ƒë√£ ƒë∆∞·ª£c g·ªçi tr∆∞·ªõc ƒë√≥
};



</script>

</body>
</html>

