<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Valentine's For Keiii</title>

<style>
/* ================= C·∫§U H√åNH CH·ªêNG ZOOM & SCROLL ================= */
* {
    box-sizing: border-box;
    /* Ch·ªëng b√¥i ƒëen text khi ch·∫°m nhanh */
    -webkit-user-select: none;
    user-select: none;
    /* B·ªè highlight m√†u xanh khi tap tr√™n Android/iOS */
    -webkit-tap-highlight-color: transparent; 
}

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    /* Kh√≥a cu·ªôn trang ho√†n to√†n */
    overflow: hidden; 
    position: fixed; 
    inset: 0;
    
    /* Ch·∫∑n h√†nh vi zoom c·ªßa tr√¨nh duy·ªát */
    touch-action: none; 
}

body {
    /* ƒê·∫£m b·∫£o t√™n file ·∫£nh n·ªÅn ch√≠nh x√°c */
    background: url("valentines-mobile.png") center/cover no-repeat #f6d6df;
    
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    -webkit-text-size-adjust: 100%;
}

/* Overlay l√†m t·ªëi n·ªÅn */
body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.2);
    z-index: 1; /* Th·∫•p h∆°n sticker */
    pointer-events: none;
    transition: 0.6s;
}

.dark::before {
    background: rgba(0,0,0,0.6);
}

/* ================= STICKER ================= */
.sticker {
    position: fixed;
    pointer-events: auto; /* ƒê·ªÉ click ƒë∆∞·ª£c v√†o sticker */
    z-index: 5; /* Cao h∆°n n·ªÅn, th·∫•p h∆°n Popup */
    opacity: 0;
    animation: life 4.4s ease-in-out forwards;
    transition: opacity 0.6s;
    cursor: pointer;
}

.letter-open .sticker {
    opacity: 0.15 !important;
    pointer-events: none;
}

@keyframes life {
    0%   {opacity: 0; transform: scale(0.85);}
    20%  {opacity: 1; transform: scale(1);}
    80%  {opacity: 1;}
    100% {opacity: 0; transform: scale(0.9);}
}

/* Panda Effect */
.panda {
    animation: life 3.5s ease-in-out forwards, pandaGlow 2.2s ease-in-out infinite alternate;
}

@keyframes pandaGlow {
    from {filter: drop-shadow(0 0 5px rgba(255,255,255,0.6));}
    to   {filter: drop-shadow(0 0 15px rgba(255,192,203,0.9));}
}

.sticker:active {
    transform: scale(0.8);
}

/* ================= POPUP (H·ªòP THO·∫†I) ================= */
.pink-box {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    /* Z-INDEX CAO: ƒê·∫£m b·∫£o popup ƒë√® l√™n sticker ƒë·ªÉ b·∫•m ƒë∆∞·ª£c n√∫t */
    z-index: 100; 
    width: min(90vw, 420px);
    padding: 30px 20px;
    background: linear-gradient(180deg, #fff9fc, #fff0f5);
    border-radius: 26px;
    border: 3px solid #f4c2d7;
    box-shadow: 0 10px 40px rgba(168, 26, 80, 0.25);
    text-align: center;
}

.heart {
    font-size: 50px;
    margin-bottom: 15px;
    animation: beat 1.8s infinite;
}

.text {
    font-size: 20px;
    font-weight: 600;
    color: #881d4b;
    line-height: 1.5;
    min-height: 60px; /* Gi·ªØ khung kh√¥ng b·ªã nh·∫£y khi text hi·ªán */
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn {
    margin-top: 25px;
    padding: 12px 50px;
    font-size: 18px;
    font-weight: 600;
    background: linear-gradient(180deg, #ffcce6, #ffa6c9);
    border: none;
    border-radius: 50px;
    cursor: pointer;
    color: #7a1f47;
    box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
    transition: transform 0.1s;
}

.btn:active {
    transform: scale(0.95);
}

.hidden { display: none !important; }

@keyframes beat {
    0%, 100% {transform: scale(1);}
    25% {transform: scale(1.15);}
    50% {transform: scale(1);}
    75% {transform: scale(1.15);}
}

/* ================= HI·ªÜU ·ª®NG TIM BAY KHI CLICK ================= */
.love-text {
    position: fixed;
    font-size: 24px;
    font-weight: bold;
    pointer-events: none;
    z-index: 200;
    white-space: nowrap;
    animation: floatUp 1.5s ease-out forwards;
    text-shadow: 0 2px 5px rgba(255,255,255,0.8);
}

@keyframes floatUp {
    0% {opacity: 0; transform: translateY(0) scale(0.8);}
    20% {opacity: 1; transform: translateY(-20px) scale(1.1);}
    100% {opacity: 0; transform: translateY(-100px) scale(1);}
}

.flying-heart {
    position: fixed;
    pointer-events: none;
    z-index: 199;
    animation: flyScatter 1.2s ease-out forwards;
}

@keyframes flyScatter {
    to { opacity: 0; transform: translate(var(--mx), var(--my)) scale(1.5); }
}

/* ================= PHONG TH∆Ø ================= */
.envelope {
    position: fixed;
    font-size: 80px;
    z-index: 150;
    top: 45%;
    left: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
}

.envelope.drop {
    animation: dropIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes dropIn {
    from {top: -20%;}
    to {top: 45%;}
}

/* ================= N·ªòI DUNG TH∆Ø ================= */
.letter-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 5000;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
    backdrop-filter: blur(4px);
}

.letter-overlay.show {
    opacity: 1;
    pointer-events: auto;
}

.letter-card {
    width: 90vw;
    max-width: 500px;
    max-height: 80vh;
    background: #fff;
    border-radius: 20px;
    padding: 60px 25px 30px;
    position: relative;
    overflow-y: auto;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    transform: translateY(30px);
    transition: transform 0.4s;
}

.letter-overlay.show .letter-card {
    transform: translateY(0);
}

.letter-card h2 {
    color: #d63384;
    text-align: center;
    margin-top: 0;
    font-family: 'Pacifico', cursive, serif; /* N·∫øu c√≥ font cute */
}

.letter-card p {
    font-size: 18px;
    line-height: 1.6;
    color: #333;
    margin-bottom: 15px;
}

.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #ffe0ef;
    color: #d63384;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
}

/* Con tr·ªè nh·∫•p nh√°y */
.cursor-heart {
    animation: blink 1s infinite;
}
@keyframes blink { 50% {opacity: 0;} }

</style>
</head>

<body>

<div id="popup1" class="pink-box">
    <div class="heart">üíó</div>
    <div id="text1" class="text"></div>
    <button class="btn" onclick="nextPopup()">D·∫°aa</button>
</div>

<div id="popup2" class="pink-box hidden">
    <div class="heart">üíì</div>
    <div id="text2" class="text"></div>
    <button class="btn" onclick="closePopup()">Iu lun</button>
</div>

<div id="envelope" class="envelope hidden">üíå</div>

<div id="letter" class="letter-overlay">
    <div class="letter-card">
        <button id="closeLetterBtn" class="close-btn">ƒê√≥ng</button>
        <h2>14.02.2026</h2>
        <div id="letterContent"></div>
    </div>
</div>

<script>
/* ================= D·ªÆ LI·ªÜU & C·∫§U H√åNH ================= */
const loveMessages = [
    "Em y√™u Ki·ªÅu", "Em y√™u ch·ªã qu√≥ √≤", "Em nh·ªõ Ki·ªÅu", "Em nh·ªõ ch·ªã qu√≥ √≤",
    "Em y√™u b√© Keii", "B√© Keii c·ªßa R√πa", "Y√™u Keii", "Ki·ªÅu ∆°i, moa moaaa",
    "C·ª•c c∆∞ng ∆°i, mu·ªën √¥m √¥m", "√îm √¥m", "Y√™u Ki·ªÅu", "Y√™u ch·ªã", "Nh·ªõ Ki·ªÅu",
    "Nh·ªõ ch·ªã", "Umoaa umoazz", "Ch·ª•t ch·ª•ttt", "Hun hun hun", "Hun ch·ª•c c√°ii",
    "H√≠t h√≠tt", "C·ª•c c∆∞ng ngoan ngoan", "Em th∆∞∆°nggg Ki·ªÅuu", "Em mu·ªën √¥m √¥m",
    "C·ª•c c∆∞ng ∆°i, mu·ªën hun hunn", "C·ª•c c∆∞ng ∆°i, mu·ªën ch·ªã", 
    "C·ª•c c∆∞ng c·ª•c c∆∞ng em y√™u ch·ªã", "C·ª•c c∆∞ng ∆°i, mu·ªën ƒÉn g√¨ d·∫°",
    "C·ª•c c∆∞ng c√≥ nh·ªõ em h√¥ng d·∫°", "C·ª•c c∆∞ng c√≥ y√™u em h√¥ng d·∫°",
    "Em y√™u ch·ªã nhi·ªÅu l·∫Øm lu√¥n √°", "V·ª£ ∆°ii, em y√™u ch·ªã"
];

// Bi·∫øn ƒëi·ªÅu khi·ªÉn
let stickerInterval;
const envelope = document.getElementById("envelope");
const letter = document.getElementById("letter");
const letterContent = document.getElementById("letterContent");
const popup1 = document.getElementById("popup1");
const popup2 = document.getElementById("popup2");

/* ================= H√ÄM TI·ªÜN √çCH ================= */
function rand(min, max) { return Math.random() * (max - min) + min; }

// H√†m l·∫•y m√†u pastel ng·∫´u nhi√™n cho ch·ªØ
function generateCuteColor() {
    const hue = Math.floor(Math.random() * 360);
    return `hsl(${hue}, 85%, 60%)`;
}

// Hi·ªáu ·ª©ng g√µ ch·ªØ
function typeWriter(element, text, speed = 50) {
    element.innerHTML = "";
    let i = 0;
    
    // T·∫°o con tr·ªè
    const cursor = document.createElement("span");
    cursor.className = "cursor-heart";
    cursor.textContent = "üíó";
    element.appendChild(cursor);

    function typing() {
        if (i < text.length) {
            cursor.before(text.charAt(i));
            i++;
            setTimeout(typing, speed);
        }
    }
    typing();
}

/* ================= H·ªÜ TH·ªêNG STICKER ================= */
// L·∫•y v·ªã tr√≠ ng·∫´u nhi√™n nh∆∞ng tr√°nh v√πng gi·ªØa m√†n h√¨nh (ƒë·ªÉ kh√¥ng che Popup)
function getSafePosition() {
    let x, y, attempts = 0;
    const padding = 60; // C√°ch m√©p m√†n h√¨nh
    
    // V√πng an to√†n ·ªü gi·ªØa (n∆°i c√≥ popup)
    const centerX = window.innerWidth / 2;
    const centerY = window.innerHeight / 2;
    const safeZoneW = 300; // Chi·ªÅu r·ªông v√πng c·∫•m
    const safeZoneH = 400; // Chi·ªÅu cao v√πng c·∫•m

    do {
        x = rand(padding, window.innerWidth - padding);
        y = rand(padding, window.innerHeight - padding);
        attempts++;
        
        // Ki·ªÉm tra xem c√≥ n·∫±m trong v√πng gi·ªØa kh√¥ng
        const inCenterX = x > (centerX - safeZoneW/2) && x < (centerX + safeZoneW/2);
        const inCenterY = y > (centerY - safeZoneH/2) && y < (centerY + safeZoneH/2);
        
        if (!inCenterX || !inCenterY) return {x, y}; // N·∫øu n·∫±m ngo√†i v√πng c·∫•m th√¨ OK

    } while (attempts < 100);
    
    return {x: rand(20, window.innerWidth-50), y: rand(20, window.innerHeight-50)}; // Fallback
}

function spawnSticker(src, isPanda) {
    const img = new Image();
    
    // S·ª¨A L·ªñI: Ki·ªÉm tra ·∫£nh c√≥ load ƒë∆∞·ª£c kh√¥ng
    img.onload = () => {
        const pos = getSafePosition();
        img.style.left = pos.x + "px";
        img.style.top = pos.y + "px";
        document.body.appendChild(img);
        
        // X√≥a sau 4.4s
        setTimeout(() => { if(img.parentNode) img.remove(); }, 4400);
    };
    
    img.onerror = () => {
        console.warn("Kh√¥ng t√¨m th·∫•y ·∫£nh:", src);
    };

    img.src = src;
    img.className = "sticker";
    if (isPanda) img.classList.add("panda");

    // Click v√†o sticker hi·ªán ch·ªØ
    img.addEventListener("click", (e) => showLoveEffect(e.clientX, e.clientY));
}

function spawnWave() {
    // Random 6 sticker th∆∞·ªùng
    for(let i=0; i<6; i++) {
        // Gi·∫£ s·ª≠ file t√™n l√† 01.png, 02.png... ƒë·∫øn 48.png
        const id = Math.floor(rand(1, 48)); 
        const name = String(id).padStart(2, '0');
        spawnSticker(`stickers/${name}.png`, false);
    }
    
    // Random 20 panda
    for(let i=0; i<15; i++) {
        // S·ª¨A L·ªñI: ƒê√£ ƒë·ªïi t√™n th∆∞ m·ª•c th√†nh 'stickers-panda'
        // Gi·∫£ s·ª≠ file t√™n 01.png ... 25.png
        const id = Math.floor(rand(1, 25));
        const name = String(id).padStart(2, '0');
        spawnSticker(`stickers-panda/${name}.png`, true);
    }
}

/* ================= HI·ªÜU ·ª®NG TIM & CH·ªÆ BAY ================= */
function showLoveEffect(x, y) {
    // 1. Hi·ªán ch·ªØ
    const textDiv = document.createElement("div");
    textDiv.className = "love-text";
    textDiv.innerText = loveMessages[Math.floor(Math.random() * loveMessages.length)];
    textDiv.style.color = generateCuteColor();
    textDiv.style.left = x + "px";
    textDiv.style.top = y + "px";
    document.body.appendChild(textDiv);
    setTimeout(() => textDiv.remove(), 1500);

    // 2. Hi·ªán tim bay tung t√≥e
    for(let i=0; i<6; i++) {
        const h = document.createElement("div");
        h.className = "flying-heart";
        h.innerText = ["üíó", "üíï", "üíû", "üíì"][Math.floor(Math.random()*4)];
        h.style.left = x + "px";
        h.style.top = y + "px";
        h.style.fontSize = rand(15, 30) + "px";
        h.style.setProperty("--mx", rand(-100, 100) + "px");
        h.style.setProperty("--my", rand(-100, -200) + "px"); // Bay l√™n tr√™n
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 1200);
    }
}

/* ================= LOGIC CH√çNH ================= */
window.onload = function() {
    typeWriter(document.getElementById("text1"), "B√© Keii ∆°ii, b√© Keii c√≥ bi·∫øt h√¥ngg??");
};

function nextPopup() {
    popup1.classList.add("hidden");
    popup2.classList.remove("hidden");
    typeWriter(document.getElementById("text2"), "Em y√™u ch·ªã nhi·ªÅu l·∫Øm lu√¥n √°!");
    
    // B·∫Øt ƒë·∫ßu m∆∞a Sticker
    spawnWave();
    stickerInterval = setInterval(spawnWave, 4000);
}

function closePopup() {
    popup2.classList.add("hidden");
    document.body.classList.add("dark"); // T·ªëi n·ªÅn
    envelope.classList.remove("hidden");
    envelope.classList.add("drop"); // R∆°i phong th∆∞ xu·ªëng
}

/* ================= X·ª¨ L√ù L√Å TH∆Ø ================= */
const letterParagraphs = [
    "Ch√∫c b√© Keii m·ªôt Valentine th·∫≠t ng·ªçt ng√†o üíó",
    "Em th∆∞∆°ng ch·ªã nhi·ªÅu l·∫Øm lu√¥n √° ü•∫",
    "C·∫£m ∆°n ch·ªã ƒë√£ xu·∫•t hi·ªán trong cu·ªôc ƒë·ªùi em üíï",
    "Y√™u ch·ªã nh·∫•tttt tr√™n ƒë·ªùi!"
];

envelope.onclick = () => {
    envelope.style.display = "none";
    letter.classList.add("show");
    
    // Hi·ªán t·ª´ng d√≤ng
    letterContent.innerHTML = "";
    letterParagraphs.forEach((txt, idx) => {
        setTimeout(() => {
            const p = document.createElement("p");
            p.innerText = txt;
            p.style.animation = "floatUp 0.5s ease forwards";
            letterContent.appendChild(p);
        }, idx * 1000);
    });
};

document.getElementById("closeLetterBtn").onclick = () => {
    letter.classList.remove("show");
    document.body.classList.remove("dark");
    // D·ª´ng sticker n·∫øu mu·ªën, ho·∫∑c ƒë·ªÉ n√≥ bay ti·∫øp
    // clearInterval(stickerInterval); 
    
    // Hi·ªán l·∫°i popup cu·ªëi ho·∫∑c reset tu·ª≥ b·∫°n, ·ªü ƒë√¢y m√¨nh ·∫©n h·∫øt ƒë·ªÉ ng·∫Øm sticker
};

</script>

</body>
</html>
